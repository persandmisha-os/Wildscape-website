<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Customer Reviews</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Leave a Review üí¨</h1>

  <!-- Review Form -->
  <form id="reviewForm">
    <label>Your Name:</label><br>
    <input type="text" id="user" required><br><br>

    <label>Your Comment:</label><br>
    <textarea id="comment" rows="4" placeholder="Write your feedback..." required></textarea><br><br>

    <label>Rating:</label><br>
    <select id="rating" required>
      <option value="">Select</option>
      <option value="1">‚≠ê 1</option>
      <option value="2">‚≠ê 2</option>
      <option value="3">‚≠ê 3</option>
      <option value="4">‚≠ê 4</option>
      <option value="5">‚≠ê 5</option>
    </select><br><br>

    <button type="submit">Submit Review</button>
  </form>

  <hr>

  <!-- Review Display Section -->
  <h2>All Reviews</h2>
  <div id="reviewList">Loading reviews...</div>

  <script>
  // Load existing reviews via AJAX
  async function loadReviews() {
    const res = await fetch('reviews.json?t=' + Date.now());
    const data = await res.json();

    // Filter visible reviews only
    const visibleReviews = data.reviews.filter(r => r.visible);
    if (visibleReviews.length === 0) {
      document.getElementById("reviewList").innerHTML = "<p>No reviews yet.</p>";
      return;
    }

    // Build HTML using DOM manipulation (via JS string building)
    document.getElementById("reviewList").innerHTML = visibleReviews.map(r =>
      `<p><b>${r.user}</b> (${r.rating}‚≠ê): ${r.comment}</p>`
    ).join('');
  }

  // Handle form submission
  document.getElementById("reviewForm").addEventListener("submit", async e => {
    e.preventDefault();

    const user = document.getElementById("user").value.trim();
    const comment = document.getElementById("comment").value.trim();
    const rating = document.getElementById("rating").value;

    if (!user || !comment || !rating) {
      alert("Please fill all fields.");
      return;
    }

    // Send data to PHP (AJAX POST)
    const formData = new FormData();
    formData.append("user", user);
    formData.append("comment", comment);
    formData.append("rating", rating);

    const res = await fetch("addReview.php", { method: "POST", body: formData });
    const msg = await res.text();
    alert(msg);

    // Reload updated list
    loadReviews();
    e.target.reset();
  });

  loadReviews(); // Initial load
  </script>
</body>
</html>
